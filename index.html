<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <script src="https://code.jquery.com/jquery-2.1.0.js"></script>
  <script src="scripts.js"></script>
  
  <link rel="stylesheet" type="text/css" href="styles.css" />

  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,700|Raleway:200" rel="stylesheet">
  <!-- Открыть на мобильных устройствах в масштабе 1:1 -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Score table tennis match</title>
</head>
<body>

<audio id="speechFile">
	<source src="source/speech/speechRu.mp3" type="audio/mp3">
</audio>

<header id="boardA">
  <h3 id="serveA">...</h2>
  <h1 id="scoreA">9</h1>
  <h2 id="playerA">9 ФамилияА</h2>
</header>

<header id="boardB">
  <h2 id="playerB">9 ФамилияБ</h2>
  <h1 id="scoreB">9</h1>
  <h3 id="serveB">...</h2>
</header>
<header id="scoreSay">
  <p id="tourney">Название турнира.
  <p id="date">дата.
  <p>&nbsp;
  <p id="info">Подачу выбрал...
  <p>[31.08.2019 20:40]
  <p>&nbsp;
  <p>&nbsp;
  <p>&nbsp;
  <p>&nbsp;
  <p>&nbsp;
  <p>&nbsp;
  <p>&nbsp;
  <p>&nbsp;
  <p>&nbsp;
  <p>&nbsp;
  <p>&nbsp;
  <p>&nbsp;
  <p>&nbsp;
  <p>&nbsp;
</header>

<p>...
<p id="speechLoad">Загрузить аудиофайл
<p>...

  <script>
	
	var scoreSay = function (scoreA, scoreB, pause) {

		// ms
		var	lengtnNum = [
			410,	// 0
			530,	// 1
			490,	// 2
			400,	// 3
			580,	// 4
			390,	// 5
		];
	
		var numSay = function (num) {
			var speech = document.getElementById('speechFile');
			if (num === 0) {
				speech.currentTime = 1;
			} else {
				speech.currentTime = num * 2;
			}
			speech.addEventListener("seeked", function() {
				speech.play();
			}, true);
			speech.addEventListener("play", function() { // "playing" работает так же
				setTimeout(function() {
					speech.pause();
				}, lengtnNum[num] + 50 );				
			}, true);
		return true;
		};
	
		numSay(scoreA);
		setTimeout(function() {
			numSay(scoreB);
		}, lengtnNum[scoreA] + 150 + pause);
	
	};	
	
	var say = { lang: "en", pause: 200 };
	var playerA = new Player("Иванов", "Иван", 750, "A");
	var playerB = new Player("Петров", "Петр", 650, "B");
	var tourney = new Tourney('Чемпионат Самарской области по настольному теннису', "25.08.2019");
	var match = new Match(5, "no comment");
	var game  = new Game();
	
	$("#playerA").text(match.scoreA + " " + playerA.lastName);
	$("#playerB").text(match.scoreB + " " + playerB.lastName);
	$("#scoreA").text(game.scoreA);
	$("#scoreB").text(game.scoreB);
	$("#tourney").text(tourney.name + ",");
	$("#date").text(tourney.date + ".");

	// Выбор игрока, подающего первым
	if (playerA.confirmFirstServe()) {
	  playerA.setFirstServe();
	  playerA.showFirstServe();
	  game.serveA = true;
	} else {
	  playerB.setFirstServe();
	  playerB.showFirstServe();
	  game.serveA = false;
	}
	// Можно и playerB
//	playerA.showServe();

	// Начать встречу, сказав "Love all" / "Ноль ноль"
	$("#speechLoad").click(function() {
		var speech = document.getElementById('speechFile');
		speech.currentTime = 0;
/*
		speech.play();
		setTimeout(function() {
			speech.pause();
		}, 2000);
*/		
	});
	
	$("#scoreSay").click(function() {
		scoreSay(5, 0, 0);
	});


	$("#boardA").click(function() {
	  game.pointWinner(playerA);
	  $("#scoreA").text(game.getScore(playerA));
	  // Партия завершена. Выиграл playerA
	  game.winner(playerA);
	});
	$("#boardB").click(function() {
	  game.pointWinner(playerB);
	  $("#scoreB").text(game.getScore(playerB));
	  // Партия завершена. Выиграл playerB
	  game.winner(playerB);
	});
	
	
  </script>

</body>
</html>